# DO NOT EDIT. Generated with:
#
#    devctl
#
#    https://github.com/giantswarm/devctl/blob/7a2bb1c2403407b720ec16e047f804471a57209e/pkg/gen/input/workflows/internal/file/cluster_app_documentation_validation.yaml.template
#

# This workflow validates the documentation generated from the JSON schema of the cluster-app
# which is located in `helm/*/values.schema.json`. Specifically, it checks whether the changes
# from `make generate-docs` were committed.

name: Documentation validation
on:
  pull_request:
    branches:
      - master
      - main
    paths:
      - 'helm/**/values.yaml'
      - 'helm/**/values.schema.json'
      - '**/*.md'  # if someone manually edited a file that should contain the generated documentation

  push: {}

jobs:
  validate:
    name: Validate documentation
    runs-on: ubuntu-latest
    env:
      GO_VERSION: 1.21.3
    steps:
      - name: Set up Go ${{ env.GO_VERSION }}
        uses: actions/setup-go@0c52d547c9bc32b1aa3301fd7a9cb496313a4491 # v5.0.0
        with:
          go-version: ${{ env.GO_VERSION }}
      - name: Checkout code
        uses: actions/checkout@1d96c772d19495a3b5c517cd2bc0cb401ea0529f # v4.1.3
      - name: "Run 'make generate-docs' and check for differences"
        run: |
          make generate-docs

          if ! git diff --exit-code; then
            echo "ERROR: You need to commit the changes made by \"make generate-docs\"."
            exit 1
          fi
