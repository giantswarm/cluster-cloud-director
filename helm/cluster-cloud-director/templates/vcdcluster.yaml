apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: VCDCluster
metadata:
  name: {{ include "resource.default.name" $ }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "labels.common" . | nindent 4 }}
spec:
  {{- with .Values.cloudDirector }}
  site: {{ .site }}
  org: {{ .org }}
  ovdc: {{ .ovdc }}
  ovdcNetwork: {{ .ovdcNetwork }}
  parentUid: {{ .parentUid }}
  useAsManagementCluster: {{ .useAsManagementCluster }}
  rdeId: {{ .rdeId }}
  {{- if .storage.createStorageClass }}
  defaultStorageClassOptions:
    vcdStorageProfileName: {{ .storage.vcdStorageProfileName }}
    k8sStorageClassName: {{ .storage.k8sStorageClassName }}
    useDeleteReclaimPolicy: {{ .storage.useDeleteReclaimPolicy }}
    fileSystem: {{ .storage.fileSystem }}
  {{- end }}
  {{- end }}
  userContext:
    {{- if .Values.userContext.secretRef.useSecretRef }}
    secretRef:
      name: {{ .Values.userContext.secretRef.secretName }}
      namespace: {{ .Release.Namespace }}
    {{- else }}
    refreshToken: {{ .Values.userContext.refreshToken }}
    username: {{ .Values.userContext.username }}
    password: {{ .Values.userContext.password }}
    {{- end }}